apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: chatapp-ingress
  namespace: chat-app
  labels:
    app: chatapp
  annotations:
    # Traefik WebSocket support
    traefik.ingress.kubernetes.io/websocket-services: "socket-service"
    # Route via HTTP entrypoint
    traefik.ingress.kubernetes.io/router.entrypoints: "web"
spec:
  ingressClassName: traefik
  rules:
  - http:
      paths:
        # Socket.io WebSocket - must be first (most specific)
        - path: "/socket.io"
          pathType: Prefix
          backend:
            service:
              name: socket-service
              port:
                number: 5004
        # Backend API - must be before frontend to match /api first
        - path: "/api"
          pathType: Prefix
          backend:
            service:
              name: backend
              port:
                number: 5001
        # Frontend - must be last to catch all other routes
        - path: "/"
          pathType: Prefix
          backend:
            service:
              name: frontend
              port:
                number: 80